{% from "govuk/components/tag/macro.njk" import govukTag %}

{#
  Service List Component
  Displays services with status indicators, sorted by priority
  Per FR-015a: FAIL services appear first
#}

{% macro serviceList(services) %}
  {% if services.length > 0 %}
    <table class="govuk-table">
      <thead class="govuk-table__head">
        <tr class="govuk-table__row">
          <th scope="col" class="govuk-table__header">Service</th>
          <th scope="col" class="govuk-table__header">Status</th>
          <th scope="col" class="govuk-table__header">Response Time</th>
          <th scope="col" class="govuk-table__header">Last Checked</th>
          <th scope="col" class="govuk-table__header">Tags</th>
        </tr>
      </thead>
      <tbody class="govuk-table__body">
        {% for service in services %}
          <tr class="govuk-table__row">
            <td class="govuk-table__cell">{{ service.name }}</td>
            <td class="govuk-table__cell">
              {% if service.status === "PASS" %}
                {{ govukTag({
                  text: "Operational",
                  classes: "govuk-tag--green"
                }) }}
              {% elif service.status === "DEGRADED" %}
                {{ govukTag({
                  text: "Degraded",
                  classes: "govuk-tag--yellow"
                }) }}
              {% elif service.status === "FAIL" %}
                {{ govukTag({
                  text: "Down",
                  classes: "govuk-tag--red"
                }) }}
              {% else %}
                {{ govukTag({
                  text: "Pending",
                  classes: "govuk-tag--grey"
                }) }}
              {% endif %}
            </td>
            <td class="govuk-table__cell">
              {% if service.latency_ms %}
                {{ service.latency_ms }}ms
              {% else %}
                <span class="govuk-hint">N/A</span>
              {% endif %}
            </td>
            <td class="govuk-table__cell">
              {% if service.last_check_time %}
                <time datetime="{{ service.last_check_time }}">
                  {{ service.last_check_time | formatDate }}
                </time>
              {% else %}
                <span class="govuk-hint">Never</span>
              {% endif %}
            </td>
            <td class="govuk-table__cell">
              {% if service.tags and service.tags.length > 0 %}
                {% for tag in service.tags %}
                  {{ govukTag({
                    text: tag,
                    classes: "govuk-tag--blue"
                  }) }}
                {% endfor %}
              {% else %}
                <span class="govuk-hint">No tags</span>
              {% endif %}
            </td>
          </tr>
          {% if service.failure_reason and service.failure_reason !== "" %}
            <tr class="govuk-table__row">
              <td class="govuk-table__cell" colspan="5">
                <span class="govuk-error-message">
                  <span class="govuk-visually-hidden">Error:</span>
                  {{ service.failure_reason }}
                </span>
              </td>
            </tr>
          {% endif %}
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p class="govuk-body">No services configured.</p>
  {% endif %}
{% endmacro %}
